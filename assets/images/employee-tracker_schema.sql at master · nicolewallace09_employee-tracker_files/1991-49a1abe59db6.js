"use strict";(()=>{var v=Object.defineProperty;var E=(S,L)=>v(S,"name",{value:L,configurable:!0});(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1991],{90051:(S,L,p)=>{var w=p(11773),r=p(93673),_=p(11427),y=p(93507),b=Object.defineProperty,C=Object.getOwnPropertyDescriptor,c=E((s,i,l,f)=>{for(var a=f>1?void 0:f?C(i,l):i,d=s.length-1,e;d>=0;d--)(e=s[d])&&(a=(f?e(i,l,a):e(a))||a);return f&&a&&b(i,l,a),a},"__decorateClass");const I="label.js-create-branch-from-issue-source-branch";(0,_.on)("click",I,s=>{const i=s.currentTarget;if(!i)return;const l=document.querySelector(".js-selected-branch"),f=i.querySelector("input");l.textContent=f.value;const a=i.closest("details");a.open=!1});let h=E(class extends HTMLElement{constructor(){super(...arguments);this.defaultRepo=""}set error(s){this.errorContainer.innerHTML=s||""}set result(s){this.resultContainer.innerHTML=s||""}set submitting(s){this.spinner.style.display=s?"inline":"none"}set baseRepoNwo(s){this.baseRepoName&&(this.baseRepoName.textContent=s,this.renderSelectItems(s))}renderSelectItems(s){this.repos.map(i=>{const l=i.closest(".js-repo-select-label");l==null||l.classList.toggle("selected",i.getAttribute("data-name")===s)})}openDialog(s){s.preventDefault();const i=this.details;i.open=!0,i.hidden=!1,i.removeAttribute("aria-hidden"),this.baseRepoNwo=this.defaultRepo}selectSourceBranch(){this.changeSourceBranchButton.hidden=!0,this.sourceBranch.hidden=!1}async setRepo(s){if(!this.sourceBranchDetails)return;const i=s.target,l=i==null?void 0:i.getAttribute("data-url"),f=i==null?void 0:i.getAttribute("data-name");if(!l||!f)return;this.baseRepoNwo=f;const a=this.sourceBranch.hidden,d=this.sourceBranchSpinner.content.cloneNode(!0);this.sourceBranchDetails.replaceWith(d),this.submitButton.disabled=!0;const e=await(0,y.a)(document,l);this.sourceBranch.replaceWith(e),this.sourceBranch.hidden=a,this.submitButton.disabled=!1}closeDialog(){const s=this.form;s.reset(),s.hidden=!1;const i=this.details;i.hidden=!0,i.setAttribute("aria-hidden","true"),this.changeSourceBranchButton.hidden=!1,this.sourceBranch.hidden=!0,this.error=null,this.result=null}async submit(s){var i;s.preventDefault(),this.submitting=!0;const l=this.form,f=await fetch(l.action,{method:l.method,body:new FormData(l)}),a=await f.text();f.ok?(this.error=null,l.hidden=!0,this.result=a):this.error=a,this.submitting=!1;const d=this.developmentForm;d&&(0,_.f)(d,"submit");const e=(i=this.desktopLink)==null?void 0:i.href;e&&window.location.replace(e)}},"CreateIssueBranchElement");c([r.fA],h.prototype,"form",2),c([r.fA],h.prototype,"developmentForm",2),c([r.fA],h.prototype,"spinner",2),c([r.fA],h.prototype,"errorContainer",2),c([r.fA],h.prototype,"details",2),c([r.fA],h.prototype,"resultContainer",2),c([r.fA],h.prototype,"baseRepoName",2),c([r.GO],h.prototype,"repos",2),c([r.fA],h.prototype,"desktopLink",2),c([r.fA],h.prototype,"changeSourceBranchButton",2),c([r.fA],h.prototype,"sourceBranch",2),c([r.fA],h.prototype,"sourceBranchSpinner",2),c([r.fA],h.prototype,"sourceBranchDetails",2),c([r.fA],h.prototype,"submitButton",2),c([r.Lj],h.prototype,"defaultRepo",2),h=c([r.Ih],h)},98496:(S,L,p)=>{var w=p(11427);(0,w.on)("details-menu-selected",".js-sync-select-menu-icon",function(r){const _=document.querySelector(".js-sync-select-menu-icon-completed"),y=document.querySelector(".js-sync-select-menu-icon-canceled"),b=r.detail.relatedTarget.querySelector('input[name="state_reason"]');(b?b.value:null)==="not_planned"?(_.style.display="none",y.style.display="inline-block"):(_.style.display="inline-block",y.style.display="none")},{capture:!0})},11773:(S,L,p)=>{var w=p(46621),r=p(20036);const{getItem:_,setItem:y,removeItem:b}=(0,w.Z)("localStorage",{throwQuotaErrorsOnSet:!0});var C=(e=>(e.Branch="branch",e.Tag="tag",e))(C||{});const c=E(class{constructor(e,t,n,u,o){this.knownItems=[],this.currentSearchResult=[],this.exactMatchFound=!1,this.isLoading=!0,this.fetchInProgress=!1,this.fetchFailed=!1,this.refType=e,this.selector=t,this.refEndpoint=n,this.cacheKey=u,this.nameWithOwner=o}render(){this.selector.render()}async fetchData(){try{if(!this.isLoading||this.fetchInProgress)return;if(!this.bootstrapFromLocalStorage()){this.fetchInProgress=!0,this.fetchFailed=!1;const e=await fetch(`${this.refEndpoint}?type=${this.refType}`,{headers:{Accept:"application/json"}});await this.processResponse(e)}this.isLoading=!1,this.fetchInProgress=!1,this.render()}catch{this.fetchInProgress=!1,this.fetchFailed=!0}}async processResponse(e){if(this.emitStats(e),!e.ok){this.fetchFailed=!0;return}const t=e.clone(),n=await e.json();this.knownItems=n.refs,this.cacheKey=n.cacheKey,this.flushToLocalStorage(await t.text())}emitStats(e){if(!e.ok){(0,r.b)({incrementKey:"REF_SELECTOR_BOOT_FAILED"},!0);return}switch(e.status){case 200:{(0,r.b)({incrementKey:"REF_SELECTOR_BOOTED_FROM_UNCACHED_HTTP"});break}case 304:{(0,r.b)({incrementKey:"REF_SELECTOR_BOOTED_FROM_HTTP_CACHE"});break}default:(0,r.b)({incrementKey:"REF_SELECTOR_UNEXPECTED_RESPONSE"})}}search(e){if(e===""){this.currentSearchResult=this.knownItems;return}const t=[],n=[];this.exactMatchFound=!1;let u;for(const o of this.knownItems)if(u=o.indexOf(e),!(u<0)){if(u===0){e===o?(n.unshift(o),this.exactMatchFound=!0):n.push(o);continue}t.push(o)}this.currentSearchResult=[...n,...t]}bootstrapFromLocalStorage(){const e=_(this.localStorageKey);if(!e)return!1;const t=JSON.parse(e);return t.cacheKey!==this.cacheKey||!("refs"in t)?(b(this.localStorageKey),!1):(this.knownItems=t.refs,this.isLoading=!1,(0,r.b)({incrementKey:"REF_SELECTOR_BOOTED_FROM_LOCALSTORAGE"}),!0)}async flushToLocalStorage(e){try{y(this.localStorageKey,e)}catch(t){if(t.message.toLowerCase().includes("quota")){this.clearSiblingLocalStorage(),(0,r.b)({incrementKey:"REF_SELECTOR_LOCALSTORAGE_OVERFLOWED"});try{y(this.localStorageKey,e)}catch(n){n.message.toLowerCase().includes("quota")&&(0,r.b)({incrementKey:"REF_SELECTOR_LOCALSTORAGE_GAVE_UP"})}}else throw t}}clearSiblingLocalStorage(){for(const e of Object.keys(localStorage))e.startsWith(c.LocalStoragePrefix)&&b(e)}get localStorageKey(){return`${c.LocalStoragePrefix}:${this.nameWithOwner}:${this.refType}`}},"_SearchIndex");let I=c;I.LocalStoragePrefix="ref-selector";var h=p(89390),s=p(93673),i=p(88317),l=Object.defineProperty,f=Object.getOwnPropertyDescriptor,a=E((e,t,n,u)=>{for(var o=u>1?void 0:u?f(t,n):t,g=e.length-1,m;g>=0;g--)(m=e[g])&&(o=(u?m(t,n,o):m(o))||o);return u&&o&&l(t,n,o),o},"__decorateClass");let d=E(class extends HTMLElement{constructor(){super(...arguments);this.isCurrentVisible=!1,this.currentSelectionIndex=null}connectedCallback(){this.refType=this.getRequiredAttr("type")==="branch"?C.Branch:C.Tag;const e=this.getAttribute("current-committish");this.currentCommittish=e?atob(e):null,this.input=this.hasAttribute("initial-filter")&&this.currentCommittish||"",this.defaultBranch=atob(this.getRequiredAttr("default-branch")),this.nameWithOwner=atob(this.getRequiredAttr("name-with-owner")),this.canCreate=this.hasAttribute("can-create"),this.prefetchOnMouseover=this.hasAttribute("prefetch-on-mouseover");const t=this.getRequiredAttr("query-endpoint"),n=this.getRequiredAttr("cache-key");this.index=new I(this.refType,this,t,n,this.nameWithOwner),this.setupFetchListeners()}inputEntered(e){this.input=e.detail,this.render()}tabSelected(){this.index.fetchData()}renderTemplate(e,t){return new h.R(e,t,h.XK)}renderRow(e){const t=this.index.currentSearchResult[e];if(!t&&e>=this.listLength)return document.createElement("span");if(this.index.fetchFailed)return this.renderTemplate(this.fetchFailedTemplate,{index:e,refName:this.input});if(!t){const m=this.input===this.currentCommittish;return this.isCurrentVisible||(this.isCurrentVisible=m),this.renderTemplate(this.noMatchTemplate,{index:e,isCurrent:m,refName:this.input})}const n=this.input.length>0,u=n?"is-filtering":"",o=t===this.currentCommittish;this.isCurrentVisible||(this.isCurrentVisible=o);const g=this.renderTemplate(this.itemTemplate,{refName:t,index:e,isFilteringClass:u,urlEncodedRefName:this.urlEncodeRef(t),isCurrent:o,isNotDefault:t!==this.defaultBranch});if(n){const m=g.querySelector("span");m.textContent="";const A=t.split(this.input),x=A.length-1;for(let R=0;R<A.length;R++){const O=A[R];if(m.appendChild(document.createTextNode(O)),R<x){const T=document.createElement("b");T.textContent=this.input,m.appendChild(T)}}}return g}urlEncodeRef(e){return encodeURIComponent(e).replaceAll("%2F","/").replaceAll("%3A",":").replaceAll("%2B","+")}render(){if(this.currentSelectionIndex=null,!this.index.isLoading){if(!this.virtualizedList){this.index.search(this.input),this.setupVirtualizedList();return}this.listContainer.scrollTop=0,this.index.search(this.input),this.virtualizedList.setRowCount(this.listLength)}}get listLength(){const e=this.index.currentSearchResult.length;return this.showCreateRow?e+1:e||1}get showCreateRow(){return!this.index.fetchFailed&&!this.index.exactMatchFound&&this.input!==""&&this.canCreate}getRequiredAttr(e,t=this){const n=t.getAttribute(e);if(!n)throw new Error(`Missing attribute for ${t}: ${e}`);return n}setupFetchListeners(){const e=this.closest("details");let t=!1;const n=E(()=>{t||(this.index.fetchData(),t=!0)},"fetch");if(!e||e.open){n();return}this.prefetchOnMouseover&&e.addEventListener("mouseover",n,{once:!0}),this.addEventListener("keydown",this.keydown),this.addEventListener("change",this.updateCurrent);const u=e.querySelector("input[data-ref-filter]");u&&(u.addEventListener("input",()=>{this.input=u.value,this.render()}),u.addEventListener("keydown",o=>{if(o.key==="ArrowDown"||o.key==="Tab")o.preventDefault(),o.stopPropagation(),this.focusFirstListMember();else if(o.key==="Enter"){let g=this.index.currentSearchResult.indexOf(this.input);if(g===-1)if(this.showCreateRow)g=this.listLength-1;else return;e.querySelector(`[data-index="${g}"]`).click(),o.preventDefault()}}))}focusFirstListMember(){!this.virtualizedList||(this.currentSelectionIndex=0,this.focusItemAtIndex(this.currentSelectionIndex))}updateCurrent(e){e.target instanceof HTMLInputElement&&e.target.checked&&e.target.value&&(this.currentCommittish=e.target.value)}keydown(e){if(this.currentSelectionIndex!==null){if(e.key==="Enter"){const t=document.activeElement;if(!t)return;t.click(),e.preventDefault();return}if(!(e.key==="Tab"&&e.shiftKey)&&e.key!=="Escape")switch(e.preventDefault(),e.stopPropagation(),e.key){case"ArrowUp":{this.currentSelectionIndex--,this.currentSelectionIndex<0&&(this.currentSelectionIndex=this.listLength-1),this.focusItemAtIndex(this.currentSelectionIndex);break}case"Home":{this.currentSelectionIndex=0,this.focusItemAtIndex(this.currentSelectionIndex);break}case"End":{this.currentSelectionIndex=this.listLength-1,this.focusItemAtIndex(this.currentSelectionIndex);break}case"Tab":case"ArrowDown":{this.currentSelectionIndex++,this.currentSelectionIndex>this.listLength-1&&(this.currentSelectionIndex=0),this.focusItemAtIndex(this.currentSelectionIndex);break}}}}focusItemAtIndex(e){this.virtualizedList.scrollToIndex(e,"center"),setTimeout(()=>{const t=this.listContainer.querySelector(`[data-index="${e}"]`);t&&t.focus()},20)}setupVirtualizedList(){this.listContainer.innerHTML="",this.virtualizedList=new i.Z(this.listContainer,{height:330,rowCount:this.listLength,renderRow:this.renderRow.bind(this),rowHeight:e=>this.showCreateRow&&e===this.listLength-1?51:33,onRowsRendered:()=>{var e;this.hiddenCurrentElement&&(this.listContainer.removeChild(this.hiddenCurrentElement),delete this.hiddenCurrentElement),this.isCurrentVisible?this.isCurrentVisible=!1:this.hiddenCurrentItemTemplate&&(this.hiddenCurrentElement=document.createElement("div"),(e=this.hiddenCurrentElement)==null||e.appendChild(this.renderTemplate(this.hiddenCurrentItemTemplate,{refName:this.currentCommittish})),this.listContainer.appendChild(this.hiddenCurrentElement))},initialIndex:0,overscanCount:6})}},"RefSelectorElement");a([s.fA],d.prototype,"listContainer",2),a([s.fA],d.prototype,"itemTemplate",2),a([s.fA],d.prototype,"noMatchTemplate",2),a([s.fA],d.prototype,"fetchFailedTemplate",2),a([s.fA],d.prototype,"hiddenCurrentItemTemplate",2),d=a([s.Ih],d)}}]);})();

//# sourceMappingURL=1991-93cf03730f54.js.map